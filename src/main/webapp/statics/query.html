<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <META HTTP-EQUIV="Pragma" CONTENT="no-cache">
    <META HTTP-EQUIV="Cache-Control" CONTENT="no-cache">
    <META HTTP-EQUIV="Expires" CONTENT="0">
    <title>入库</title>
    <link href="css/bootstrap.css" rel="stylesheet"/>
    <link href="css/bootstrap-datetimepicker.min.css" rel="stylesheet" media="screen">
    <link rel="stylesheet" href="css/preset.css">
    <link/>
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/cus.js"></script>
    <script type="text/javascript" src="js/bootstrap-datetimepicker.js" charset="UTF-8"></script>
    <script type="text/javascript" src="js/locales/bootstrap-datetimepicker.zh-CN.js" charset="UTF-8"></script>
</head>
<body>
<h2>出入库管理系统</h2>
<p></p>
<ul class="nav nav-pills" role="tablist">
    <li role="presentation"><a href="index.html">查询库存</a></li>
    <li role="presentation"><a href="detail.html">出入记录</a></li>
    <li role="presentation"><a href="ruku.html">新增入库</a></li>
    <li role="presentation"><a href="out.html">新增出库</a></li>
    <li role="presentation"><a href="additemname.html">添加名称</a></li>
    <li role="presentation"><a href="additem.html">添加商品</a>
    <li role="presentation" class="active"><a href="query.html">查询</a>
    <li>
        <button id="logout" class="btn btn-warning" type="button">退出</button>
    </li>
</ul>
<p></p>

<div class="form-group form-inline">
    <div>
        <label>请选择查询方式:</label>
        <label for="radio1">
            <input id="radio1" type="radio" name="condition" value="1" checked onclick="to_change()">
            多条件查询</label>
        <label style="width:100px;"></label>
        <label for="radio2">
            <input id="radio2" type="radio" name="condition" value="2" onclick="to_change()">
            按住院号查询</label>
    </div>
</div>

<div id="queryCdn" style="display: none" class="form-group form-inline">
    <div class="form-group form-inline">
        <label for="zhuanyuan_no">住院号:</label>
        <label><input type="text" id="zhuanyuan_no" class="form-control"></label>
    </div>
</div>

<div id="mutil" style="display: none">
    <div class="form-group form-inline">
        <label>医生:</label>
        <div class="checkbox"><label style="width: 70px;"><input type="checkbox" name="doctor" value="徐三中"> 徐三中</label>
        </div>
        <div class="checkbox"><label style="width: 70px;"><input type="checkbox" name="doctor" value="陈斌"> 陈斌</label>
        </div>
        <div class="checkbox"><label style="width: 70px;"><input type="checkbox" name="doctor" value="凌志恒"> 凌志恒</label>
        </div>
        <div class="checkbox"><label style="width: 70px;"><input type="checkbox" name="doctor" value="顾鹏程"> 顾鹏程</label>
        </div>
        <div class="checkbox"><label style="width: 70px;"><input type="checkbox" name="doctor" value="陈中"> 陈中</label>
        </div>
        <div class="checkbox"><label style="width: 70px;"><input type="checkbox" name="doctor" value="张玉柱"> 张玉柱</label>
        </div>
    </div>

    <div class="form-group form-inline">
        <div class="checkbox"><label>跟台:</label></div>
        <div class="checkbox"><label style="width: 70px;"><input type="checkbox" name="gentai" value="杨昕"> 杨昕</label>
        </div>
        <div class="checkbox"><label style="width: 70px;"><input type="checkbox" name="gentai" value="李荣兵"> 李荣兵</label>
        </div>
        <div class="checkbox"><label style="width: 70px;"><input type="checkbox" name="gentai" value="车佳莲"> 车佳莲</label>
        </div>
    </div>

    <div class="form-group form-inline">
        <div class="checkbox"><label>时间:</label></div>
        <div class="form-group">
            <label for="dtp_input2" class="control-label"></label>
            <div class="input-group date form_date" data-date="" data-date-format="yyyy年mm月dd日"
                 data-link-field="dtp_input2"
                 data-link-format="yyyy-mm-dd">
                <input class="form-control" size="12" type="text" value="" readonly>
                <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
            </div>
            <input type="hidden" id="dtp_input2" value=""/><br/>
        </div>

        <div class="form-group">
            <label for="dtp_input3" class="control-label">至：</label>
            <div class="input-group date form_date" data-date="" data-date-format="yyyy年mm月dd日"
                 data-link-field="dtp_input3"
                 data-link-format="yyyy-mm-dd">
                <input class="form-control" size="12" type="text" value="" readonly>
                <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
            </div>
            <input type="hidden" id="dtp_input3" value=""/><br/>
        </div>
    </div>
</div>
<div class="form-group">
    <input id="btnQuery" type="button" class="btn btn-default " value="查询"/>
</div>

<table id="tablein" class="table .table-striped">
    <thead>
    <tr>
        <th><span>商品类型</span></th>
        <th><span>商品名称</span></th>
        <th><span>商品型号</span></th>
        <th><span>商品数量</span></th>
        <th><span>商品来源</span></th>
    </tr>
    </thead>
    <tbody id="table_body">

    </tbody>
</table>


<script>
    var queryType = 1;

    function addQueryConditionByZhuanyuanNo() {
        queryType = 2;
        $("#mutil").hide();
        $("#queryCdn").show();
    }

    function addQueryMutilCondition() {
        queryType = 1;
        $("#queryCdn").hide();
        $("#mutil").show();
    }

    function doQuery(){
        var zhuyuanNo = $("#zhuanyuan_no").val();

        if(queryType == 2) {
            if (zhuyuanNo == "") {
                alert("住院号不能为空");
                return;
            }
        }
        var params = {
            "queryType":queryType
        };

        if(queryType == 2)
        {
            params.zhuyuanNO = zhuyuanNo;
        }
        else
        {
            var start = $("#dtp_input2").val();
            var end = $("#dtp_input3").val();
            params.start = start;
            params.end = end;
            var docnames = $("input[name='doctor']:checked");
            var gentais = $("input[name='gentai']:checked");

            var docnameslen = docnames.length;
            if(docnameslen>0)
            {
                var arrdocnames = new Array();
                for(var cnt = 0; cnt < docnameslen; cnt++)
                {
                    arrdocnames[cnt] = docnames[cnt].value;
                }
                params.docNameList = arrdocnames;
            }

            var gentailen = gentais.length;
            if(gentailen>0)
            {
                var arrgentais = new Array();
                for(var cnt = 0; cnt < gentailen; cnt++)
                {
                    arrgentais[cnt] = gentais[cnt].value;
                }
                params.gentaiList = arrgentais;
            }


//            console.log(docnames);
//            console.log(tentan);
            console.log(params);
            return;
        }

        console.log(JSON.stringify(params));
        //$("#btnSave").attr({"disabled": "disabled"});
        $.ajax({
            type: "POST",//请求方式，get或post
            url: "/records/query",
            data: JSON.stringify(params),
            contentType: "application/json; charset=utf-8",
            dataType: 'json',
            timeout: 15000,  //超时时间设置，单位毫秒
            error: function (XmlHttpRequest, textStatus, errorThrown) {
                //$("#btnSave").removeAttr("disabled");
                alert('系统繁忙,请稍后再试');
            },
            success: function (data) {
                //$("#btnSave").removeAttr("disabled");
                console.log(data);
                if (data.code == 0) {

                } else if (1000 == data.code) {
                    alert(data.message);
                    window.location = data.data;
                }
                else {
                    alert(data.message);
                }
            }
        });


    }

    $(function () {
        addQueryMutilCondition();       //默认多条件查询

        $('.form_date').datetimepicker({
            language: 'zh-CN',
            weekStart: 1,
            todayBtn: 1,
            autoclose: 1,
            todayHighlight: 1,
            startView: 2,
            minView: 2,
            forceParse: 0
        });

        $("#btnQuery").click(function (event) {
            doQuery();
        });

    });

    function to_change() {
        var obj = document.getElementsByName('condition');
        console.log(obj);
        for (var i = 0; i < obj.length; i++) {
            if (obj[i].checked == true) {
                if (obj[i].value == '2') {  //住院号
                    addQueryConditionByZhuanyuanNo();
                }
                else {
                    //多条件
                    addQueryMutilCondition();
                }
            }
        }
    }


    $('.form_date').datetimepicker({
        language: 'zh-CN',
        weekStart: 1,
        todayBtn: 1,
        autoclose: 1,
        todayHighlight: 1,
        startView: 2,
        minView: 2,
        forceParse: 0
    });

</script>

</body>
</html>